<% require 'json' -%>
# This file is managed by Puppet
# MODIFICATION WILL BE OVERWRITTEN

# Node Configs
<% if @host and @host != '' -%>
druid.host=<%= @host %>
<% end -%>
<% if @port and @port != '' -%>
druid.port=<%= @port %>
<% end -%>
<% if @service and @service != '' -%>
druid.service=<%= @service %>
<% end -%>

# Query Configs
<% if @balancer_type and @balancer_type != '' -%>
druid.broker.balancer.type=<%= @balancer_type %>
<% end -%>
<% if @select_tier and @select_tier != '' -%>
druid.broker.select.tier=<%= @select_tier %>
<% end -%>
<% if @select_tier_custom_priorities and @select_tier_custom_priorities != [] and @select_tier_custom_priorities != '' -%>
druid.broker.select.tier.custom.priorities=[<%= @select_tier_custom_priorities.join(',') %>]
<% end -%>
<% if @server_http_num_threads and @server_http_num_threads != '' -%>
druid.server.http.numThreads=<%= @server_http_num_threads %>
<% end -%>
<% if @server_http_max_idle_time and @server_http_max_idle_time != '' -%>
druid.server.http.maxIdleTime=<%= @server_http_max_idle_time %>
<% end -%>
<% if @http_num_connections and @http_num_connections != '' -%>
druid.broker.http.numConnections=<%= @http_num_connections %>
<% end -%>
<% if @http_read_timeout and @http_read_timeout != '' -%>
druid.broker.http.readTimeout=<%= @http_read_timeout %>
<% end -%>
<% if @retry_policy_num_tries and @retry_policy_num_tries != '' -%>
druid.broker.retryPolicy.numTries=<%= @retry_policy_num_tries %>
<% end -%>
<% if @processing_buffer_size_bytes and @processing_buffer_size_bytes != '' -%>
druid.processing.buffer.sizeBytes=<%= @processing_buffer_size_bytes %>
<% end -%>
<% if @processing_format_string and @processing_format_string != '' -%>
druid.processing.formatString=<%= @processing_format_string %>
<% end -%>
<% if @processing_num_threads and @processing_num_threads != '' -%>
druid.processing.numThreads=<%= @processing_num_threads %>
<% end -%>
<% if @processing_column_cache_size_bytes and @processing_column_cache_size_bytes != '' -%>
druid.processing.columnCache.sizeBytes=<%= @processing_column_cache_size_bytes %>
<% end -%>
<% if @query_group_by_single_threaded != '' -%>
druid.query.groupBy.singleThreaded=<%= @query_group_by_single_threaded %>
<% end -%>
<% if @query_group_by_max_intermediate_rows and @query_group_by_max_intermediate_rows != '' -%>
druid.query.groupBy.maxIntermediateRows=<%= @query_group_by_max_intermediate_rows %>
<% end -%>
<% if @query_group_by_max_results and @query_group_by_max_results != '' -%>
druid.query.groupBy.maxResults=<%= @query_group_by_max_results %>
<% end -%>
<% if @query_search_max_search_limit and @query_search_max_search_limit != '' -%>
druid.query.search.maxSearchLimit=<%= @query_search_max_search_limit %>
<% end -%>

# Caching
<% if @cache_use_cache != '' -%>
druid.broker.cache.useCache=<%= @cache_use_cache %>
<% end -%>
<% if @cache_populate_cache != '' -%>
druid.broker.cache.populateCache=<%= @cache_populate_cache %>
<% end -%>
<% if @cache_type and @cache_type != '' -%>
druid.cache.type=<%= @cache_type %>
<% end -%>
<% if @cache_uncacheable and @cache_uncacheable != [] and @cache_uncacheable != '' -%>
druid.broker.cache.unCacheable=<%= @cache_uncacheable.to_json %>
<% end -%>
<% if @cache_type == 'local' -%>
    <%- if @cache_size_in_bytes and @cache_size_in_bytes != '' -%>
druid.cache.sizeInBytes=<%= @cache_size_in_bytes %>
    <%- end -%>
    <%- if @cache_initial_size and @cache_initial_size != '' -%>
druid.cache.initialSize=<%= @cache_initial_size %>
    <%- end -%>
    <%- if @cache_log_eviction_count and @cache_log_eviction_count != '' -%>
druid.cache.logEvictionCount=<%= @cache_log_eviction_count %>
    <%- end -%>
<% elsif @cache_type == 'memcached' -%>
    <%- if @cache_expiration and @cache_expiration != '' -%>
druid.cache.expiration=<%= @cache_expiration %>
    <%- end -%>
    <%- if @cache_timeout and @cache_timeout != '' -%>
druid.cache.timeout=<%= @cache_timeout %>
    <%- end -%>
    <%- if @cache_hosts and @cache_hosts != [] and @cache_hosts != '' -%>
druid.cache.hosts=<%= @cache_hosts.join(',') %>
    <%- end -%>
    <%- if @cache_max_object_size and @cache_max_object_size != '' -%>
druid.cache.maxObjectSize=<%= @cache_max_object_size %>
    <%- end -%>
    <%- if @cache_memcached_prefix and @cache_memcached_prefix != '' -%>
druid.cache.memcachedPrefix=<%= @cache_memcached_prefix %>
    <%- end -%>
<% end -%>

# GroupBy Engine
<% if @num_merge_buffers and @nun_merge_buffers != '' -%>
druid.processing.numMergeBuffers=<%= @num_merge_buffers %>
<% end -%>

# Druid SQL
<% if @sql_enable and @sql_enable != '' -%>
druid.sql.enable=<%= @sql_enable %>
<% end -%>